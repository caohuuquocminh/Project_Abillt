<!DOCTYPE html>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<html lang="de" xml:lang="de" xmlns="http://www.w3.org/1999/xhtml">

<h1><b><p><%= @category.name %></p></b></h1>

<section class="product">
	<% if @product %>
	<p>
		<strong>Category:</strong><%= @product.name %>
	</p>
	<% end %>
</section>

<%= link_to "All Apps", categories_path(@category.name) %> 
<br></br>

<%= label_tag "Type of Sort" %>
<table id="products">
	<tr>
		<li><%= sort_link @search, :name, "Product Name" %></li>
		<li><%= sort_link @search, :price, "Price" %></li>    
		<li><%= sort_link @search, :average, "Best Rated" %></li>
		<li><%= sort_link @search, :total, "Most Rated" %></li>
	</tr>
</table>
</br>

<%= label_tag "Type of Filter -> Operating Systems" %>
<% @products.each do |product| %>
<% product.operatingsystems.each do |operation| %>
<li><%= link_to operation.name, controller: "categories", action: "show", id: @category.id, operatingsystem_id: operation.id  %></li>
<% end %>
<% end %>
</br>

<%= label_tag "Type of Filter -> Language" %>
<% @products.each do |product| %>
<% product.languages.each do |lang| %>
<li><%= link_to lang.name, controller: "categories", action: "show", id: @category.id, language_id: lang.id %></li>
<% end %>
<% end %>
</br>

<% if @free_app.present? %>
<%= label_tag "Free" %>
<li><%= link_to "Free", controller: "categories", action: "show", id: @category.id, price: '0' %></li>
</br>
<% end %>


<% unless @lang.present? || @os.present? || @free.present? %>
<div class="row">
	<% @products.each do |product| %>
	<div class="col-md-2 col-sm-2">
		<div class="team-member">
			<div class="thumnail">
				<%= image_tag product.app_img.url(:app_index) %></a>
			</div>
			<p><%= link_to product.name, app_path(product) %></p>
			<p> 
				<% product.operatingsystems.each do |operation| %>
				<li><%= operation.name %></li>
				<% end %>
			</ul>
		</p>
		<p> 
			<% product.languages.each do |lang| %>
			<li><%= lang.name %></li>
			<% end %>
		</ul>
	</p>
	<p class="app-name"><%= number_to_currency(product.price) %></p>
	<div class="average-review-rating" data-score=<%= product.reviews.average(:rating) %>></div>
</div><br></br>
</div>
<% end %>
</div>
<% end %>

<div class="row">
	<% @lang.each do |product| %>
	<div class="col-md-2 col-sm-2">
		<div class="team-member">
			<div class="thumnail">
				<%= image_tag product.app_img.url(:app_index) %></a>
			</div>
			<p><%= link_to product.name, app_path(product) %></p>
			<p> 
				<% product.operatingsystems.each do |operation| %>
				<li><%= operation.name %></li>
				<% end %>
			</ul>
		</p>
		<p> 
			<% product.languages.each do |lang| %>
			<li><%= lang.name %></li>
			<% end %>
		</ul>
	</p>
	<p class="app-name"><%= number_to_currency(product.price) %></p>
	<div class="average-review-rating" data-score=<%= product.reviews.average(:rating) %>></div>
</div><br></br>
</div>
<% end %>
</div>

<div class="row">
	<% @os.each do |product| %>
	<div class="col-md-2 col-sm-2">
		<div class="team-member">
			<div class="thumnail">
				<%= image_tag product.app_img.url(:app_index) %></a>
			</div>
			<p><%= link_to product.name, app_path(product) %></p>
			<p> 
				<% product.operatingsystems.each do |operation| %>
				<li><%= operation.name %></li>
				<% end %>
			</ul>
		</p>
		<p> 
			<% product.languages.each do |lang| %>
			<li><%= lang.name %></li>
			<% end %>
		</ul>
	</p>
	<p class="app-name"><%= number_to_currency(product.price) %></p>
	<div class="average-review-rating" data-score=<%= product.reviews.average(:rating) %>></div>
</div><br></br>
</div>
<% end %>
</div>

<div class="row">
	<% @free.each do |product| %>
	<div class="col-md-2 col-sm-2">
		<div class="team-member">
			<div class="thumnail">
				<%= image_tag product.app_img.url(:app_index) %></a>
			</div>
			<p><%= link_to product.name, app_path(product) %></p>
			<p> 
				<% product.operatingsystems.each do |operation| %>
				<li><%= operation.name %></li>
				<% end %>
			</ul>
		</p>
		<p> 
			<% product.languages.each do |lang| %>
			<li><%= lang.name %></li>
			<% end %>
		</ul>
	</p>
	<p class="app-name"><%= number_to_currency(product.price) %></p>
	<div class="average-review-rating" data-score=<%= product.reviews.average(:rating) %>></div>
</div><br></br>
</div>
<% end %>
</div>

<script>
	$('.average-review-rating').raty({
		readOnly: true,
		path: '/assets/',
		score: function() {
			return $(this).attr('data-score')
		}
	});
</script>



<%= link_to 'Bearbeiten', edit_category_path(@category) %>